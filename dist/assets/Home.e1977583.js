var de=Object.defineProperty,_e=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var te=(e,n,s)=>n in e?de(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,j=(e,n)=>{for(var s in n||(n={}))me.call(n,s)&&te(e,s,n[s]);if(ee)for(var s of ee(n))ge.call(n,s)&&te(e,s,n[s]);return e},Q=(e,n)=>_e(e,he(n));import{o,h,O as l,a2 as J,r as c,b as r,d as m,a3 as $,N as w,i as v,P as D,X as B,Q as b,a as S,w as I,F as E,a4 as fe,Y as A,W as z,g as Y,a5 as pe,e as X,a6 as ve,f as Z,Z as P,S as q,T as H,u as ye,a7 as Ce}from"./vendor.e16af399.js";import{_ as C,s as y,r as se,u as be}from"./index.5d7405f0.js";var O={JOIN_CHAT:"join-chat",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",LEAVE_CHAT:"leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room"};const Se={name:"EmptyChatMessages"},we={class:"self-center"};function Ue(e,n,s,t,d,_){return o(),h("div",we,l(e.$t("No messages")),1)}var Ie=C(Se,[["render",Ue]]);const ne=()=>{const e=J("all-users-online");return{isOnline:s=>e.value.some(t=>t===s)}},Me={name:"UserInfo",props:{user:{type:Object,required:!0}}},xe={class:"p-3 border-b border-gray-200"},Ee={class:"flex"},$e={class:"mt-3 space-y-1"},ke={class:"text-md font-semibold"},Te={class:"text-sm"},Ne={class:"font-semibold"},Oe={class:"font-semibold"},Le={class:"font-semibold"};function Ae(e,n,s,t,d,_){const a=c("app-avatar");return o(),h("div",xe,[r("div",Ee,[m(a,{name:s.user.username,classes:["h-12","w-12"]},null,8,["name"])]),r("div",$e,[r("div",ke,l(s.user.username),1),r("div",Te,[r("div",null,[r("span",Ne,l(e.$t("Email"))+":",1),$(" "+l(s.user.email),1)]),r("div",null,[r("span",Oe,l(e.$t("Age"))+":",1),$(" "+l(s.user.age),1)]),r("div",null,[r("span",Le,l(e.$t("Gender"))+":",1),$(" "+l(e.$t(e.$filters.ucFirst(s.user.gender))),1)])])])])}var ae=C(Me,[["render",Ae]]);const Re={name:"ChatMessageItem",props:{message:{type:Object,required:!0},isCurrentUserMessage:{type:Boolean,default:!1}},setup(e){const n=w(null),s=v(()=>{var a;return(a=y.getters["chat/currentChat"])!=null?a:null}),t=w(!1),d=v(()=>e.isCurrentUserMessage?null:e.message.user.username),_=()=>{if(s.value.users.length&&e.message.user._id){const a=s.value.users.filter(i=>i._id===e.message.user._id);a&&(n.value=a[0],t.value=!0)}};return Q(j({},ne()),{username:d,showUserInfoModal:_,modal:t,user:n})},components:{UserInfo:ae}},Fe={class:"chat-message"},je={class:"flex flex-col items-end"},Be={class:"leading-3 text-xs"};function Pe(e,n,s,t,d,_){const a=c("app-avatar"),i=c("user-info"),g=c("app-modal");return o(),h(E,null,[r("div",Fe,[r("div",{class:D(["flex items-end",{"justify-end":s.isCurrentUserMessage}])},[r("div",{class:D([[s.isCurrentUserMessage?"order-1 items-end":"order-2 items-start"],"flex flex-col space-y-2 text-sm max-w-xs"])},[r("div",null,[r("div",{class:D(["px-4 py-2 rounded-lg inline-block",[s.isCurrentUserMessage?"rounded-br-none bg-blue-600 text-white":"bg-gray-200 text-gray-600 rounded-bl-none"]])},[t.username?(o(),h("a",{key:0,class:"underline",href:"#",onClick:n[0]||(n[0]=B((...p)=>t.showUserInfoModal&&t.showUserInfoModal(...p),["prevent"]))},l(t.username),1)):b("",!0),r("div",null,l(s.message.text),1),r("div",je,[r("div",Be,l(e.$filters.passedTime(s.message.time)),1)])],2)])],2),r("div",{class:"relative mr-2 cursor-pointer",onClick:n[1]||(n[1]=(...p)=>t.showUserInfoModal&&t.showUserInfoModal(...p))},[s.isCurrentUserMessage?b("",!0):(o(),S(a,{key:0,name:t.username,"is-online":e.isOnline(s.message.user._id)},null,8,["name","is-online"]))])],2)]),t.modal?(o(),S(g,{key:0,state:t.modal,"onUpdate:state":n[2]||(n[2]=p=>t.modal=p),title:e.$t("Information about user")},{default:I(()=>[t.user?(o(),S(i,{key:0,user:t.user},null,8,["user"])):b("",!0)]),_:1},8,["state","title"])):b("",!0)],64)}var qe=C(Re,[["render",Pe]]);const Ve={components:{EmptyChatMessages:Ie,ChatMessageItem:qe},name:"ChatMessages",props:{messages:{type:Array,default:()=>[]},currentUserId:{type:String,required:!0},isProgressStatusMessages:{type:Boolean}}},De={class:"relative flex-1 justify-between flex flex-col h-screen"},He={key:1,class:"chat-messages-area"};function Je(e,n,s,t,d,_){const a=c("app-loader"),i=c("chat-message-item"),g=c("empty-chat-messages"),p=c("app-bg-pattern"),M=fe("scroll-down");return o(),h("div",De,[s.isProgressStatusMessages?(o(),S(a,{key:0})):A((o(),h("div",He,[s.messages.length?(o(!0),h(E,{key:0},z(s.messages,x=>(o(),S(i,{key:x._id,message:x,"is-current-user-message":x.user._id===s.currentUserId},null,8,["message","is-current-user-message"]))),128)):(o(),S(g,{key:1}))])),[[M,s.messages.length]]),m(p)])}var Ge=C(Ve,[["render",Je]]);const We={name:"ChatMessageForm",emits:["join-chat","typing-message","send-message"],props:{isJoin:{type:Boolean,required:!0},isButtonLoading:{type:Boolean,required:!0},isSidebarOpen:{type:Boolean}},setup(e,{emit:n}){const s=w(!1),t=w(""),d=()=>{n("send-message",t.value),t.value="",s.value=!0},_=()=>{n("join-chat"),s.value=!0};return Y(t,()=>{n("typing-message")}),{joinChat:_,message:t,sendMessage:d,isFocus:s}}},Ke={class:"chat-message-form flex justify-center"},Qe={key:1,class:"flex gap-3 grow"},ze={class:"grow"};function Ye(e,n,s,t,d,_){const a=c("app-button"),i=c("app-textarea"),g=c("app-icon");return o(),h("div",Ke,[s.isJoin?(o(),h("div",Qe,[m(i,{modelValue:t.message,"onUpdate:modelValue":n[0]||(n[0]=p=>t.message=p),modelModifiers:{trim:!0},isFocus:t.isFocus,class:"grow-2",onKeyup:pe(B(t.sendMessage,["exact","prevent"]),["enter"])},null,8,["modelValue","isFocus","onKeyup"]),r("div",ze,[r("button",{onClick:n[1]||(n[1]=(...p)=>t.sendMessage&&t.sendMessage(...p)),type:"button",class:"chat-message-button"},[m(g,{icon:"paper-airplane",class:"h-6 w-6 transform rotate-90"})])])])):(o(),S(a,{key:0,isButtonLoading:s.isButtonLoading,onClick:t.joinChat,color:"success",type:"button"},{default:I(()=>[$(l(e.$t("Join chat")),1)]),_:1},8,["isButtonLoading","onClick"]))])}var Xe=C(We,[["render",Ye]]),T={NEW_USER_JOIN:"new-user-join",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",USER_LEAVE_CHAT:"user-leave-chat",USER_OFFLINE:"user-offline",USER_ONLINE:"user-online",USER_REFRESH_AFTER_LEAVE_CHAT:"user-refresh-after-leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room"};const Ze={name:"NoChatsSelected"},et={class:"h-screen flex items-center justify-center"},tt={class:"container"};function st(e,n,s,t,d,_){const a=c("app-alert");return o(),h("div",et,[r("div",tt,[m(a,{type:"info"},{default:I(()=>[$(l(e.$t("No chats selected")),1)]),_:1})])])}var nt=C(Ze,[["render",st]]);const at={name:"ChatUserItem",props:{user:{type:Object,required:!0},isOnline:{type:Boolean,required:!0}}},ot={class:"flex items-center gap-3 px-6 py-3 cursor-default hover:bg-gray-100"},rt={class:"relative"},it={class:"grow"},ct={class:"flex items-center gap-1"},lt=["textContent"],ut=["textContent"];function dt(e,n,s,t,d,_){const a=c("app-avatar");return o(),h("div",ot,[r("div",rt,[m(a,{name:s.user.username,"is-online":s.isOnline},null,8,["name","is-online"])]),r("div",it,[r("div",ct,[r("span",{textContent:l(s.user.username),class:"block font-semibold text-base text-gray-600"},null,8,lt)]),s.isOnline?(o(),h("div",{key:0,class:"text-sm text-blue-400",textContent:l(e.$t("online"))},null,8,ut)):b("",!0)])])}var _t=C(at,[["render",dt]]);const ht={components:{ChatUserItem:_t},name:"ChatUsersList",props:{users:{type:Array,required:!0}},setup(){return j({},ne())}};function mt(e,n,s,t,d,_){const a=c("chat-user-item");return o(!0),h(E,null,z(s.users,i=>(o(),S(a,{key:i._id,user:i,"is-online":e.isOnline(i._id)},null,8,["user","is-online"]))),128)}var gt=C(ht,[["render",mt]]);const ft={name:"ChatInfo",props:{chatName:{type:String,required:!0},countUsersChat:{type:Number,required:!0},users:{type:Array,default:()=>[]},clientsCount:{type:Number,required:!0}},components:{ChatUsersList:gt}},pt={class:"flex items-center gap-3 px-6 py-3"},vt={class:"grow"},yt={class:"flex items-center gap-1"},Ct=["textContent"],bt={class:"text-sm text-gray-400"},St=r("div",{class:"border-b border-solid border-gray-200"},null,-1);function wt(e,n,s,t,d,_){const a=c("app-avatar"),i=c("app-icon"),g=c("chat-users-list");return o(),h(E,null,[r("div",pt,[m(a,{name:s.chatName,classes:["w-12","h-12"]},null,8,["name"]),r("div",vt,[r("div",yt,[m(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("span",{textContent:l(s.chatName),class:"block font-semibold text-base text-gray-600"},null,8,Ct)]),r("div",bt,[s.countUsersChat?(o(),h(E,{key:0},[$(l(s.countUsersChat)+" "+l(e.$t("groupMembers")),1)],64)):b("",!0),s.clientsCount?(o(),h(E,{key:1},[$(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)])])]),St,s.users.length?(o(),S(g,{key:0,users:s.users},null,8,["users"])):b("",!0)],64)}var Ut=C(ft,[["render",wt]]);const It={name:"ChatTyping",props:{userTypingName:String}},Mt={class:"flex gap-1"},xt={class:"text-sm text-blue-400"};function Et(e,n,s,t,d,_){const a=c("app-typing-loader");return o(),h("div",Mt,[m(a),r("div",xt,l(s.userTypingName)+" "+l(e.$t("typing")),1)])}var $t=C(It,[["render",Et]]);const kt={components:{ChatInfo:Ut,ChatTyping:$t},name:"SelectedChatInfo",emits:["change-state-dropdown-item"],props:{currentChatInfo:{type:Object,required:!0},clientsCount:{type:Number,required:!0},isTyping:{type:Boolean,default:!1},userTypingName:{type:String},showInfoChatGroupFromDropdown:{type:Boolean}},setup(e,{emit:n}){const s=w(!1),t=v(()=>e.currentChatInfo.name),d=v(()=>e.currentChatInfo.users.length),_=()=>{s.value=!0},a=i=>{s.value=i,n("change-state-dropdown-item",!i)};return Y(()=>e.showInfoChatGroupFromDropdown,i=>{i&&a(i)}),{chatName:t,countUsersChat:d,modal:s,showModalInfo:_}}},Tt={class:"font-bold text-base text-gray-600"},Nt={class:"h-5"},Ot={key:1,class:"text-sm text-gray-400"},Lt={key:1};function At(e,n,s,t,d,_){const a=c("chat-typing"),i=c("chat-info"),g=c("app-modal");return o(),h(E,null,[r("div",null,[r("div",Tt,l(t.chatName),1),r("div",Nt,[s.isTyping?(o(),S(a,{key:0,"user-typing-name":s.userTypingName},null,8,["user-typing-name"])):(o(),h("div",Ot,[t.countUsersChat?(o(),h("div",{key:0,class:"cursor-pointer",onClick:n[0]||(n[0]=(...p)=>t.showModalInfo&&t.showModalInfo(...p))},[$(l(t.countUsersChat)+" "+l(e.$t("groupMembers"))+" ",1),s.clientsCount?(o(),h(E,{key:0},[$(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)])):(o(),h("div",Lt,[$(l(t.countUsersChat)+" "+l(e.$t("groupMembers"))+" ",1),s.clientsCount?(o(),h(E,{key:0},[$(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)]))]))])]),t.modal?(o(),S(g,{key:0,state:t.modal,"onUpdate:state":n[1]||(n[1]=p=>t.modal=p),title:e.$t("Information about chat group")},{default:I(()=>[m(i,{"chat-name":t.chatName,"count-users-chat":t.countUsersChat,users:s.currentChatInfo.users,"clients-count":s.clientsCount},null,8,["chat-name","count-users-chat","users","clients-count"])]),_:1},8,["state","title"])):b("",!0)],64)}var Rt=C(kt,[["render",At]]);const Ft=()=>{const{t:e}=X();return{logout:async()=>{await y.dispatch("auth/logout"),se.push({name:"login"}),y.dispatch("setNotify",{type:"success",message:e("Logout Message")},{root:!0})}}},jt={name:"ChatDropdownActions",emits:["leave-chat","show-info-chat-group-from-dropdown"],props:{isJoin:{type:Boolean,required:!0},selectedChatId:{type:String}},setup(){return j({},Ft())}},Bt={class:"list-none overflow-hidden py-2"},Pt={key:0},qt=["textContent"],Vt={key:1},Dt=["textContent"],Ht=["textContent"];function Jt(e,n,s,t,d,_){return o(),h("ul",Bt,[s.selectedChatId?(o(),h("li",Pt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[0]||(n[0]=B(a=>e.$emit("show-info-chat-group-from-dropdown",!0),["prevent"])),textContent:l(e.$t("Information about chat group"))},null,8,qt)])):b("",!0),s.isJoin?(o(),h("li",Vt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[1]||(n[1]=B(a=>e.$emit("leave-chat"),["prevent"])),textContent:l(e.$t("Leave chat"))},null,8,Dt)])):b("",!0),r("li",null,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[2]||(n[2]=B((...a)=>e.logout&&e.logout(...a),["prevent"])),textContent:l(e.$t("Logout"))},null,8,Ht)])])}var Gt=C(jt,[["render",Jt]]);const Wt={name:"CurrentChat",emits:["toggle-sidebar"],props:{isSidebarOpen:Boolean,currentUser:{type:Object,required:!0}},setup(e,{emit:n}){const{t:s}=X(),t=J("socket"),d=w(0),_=w(!1),a=w(!1),i=f=>{a.value=f},g=f=>{a.value=f},p=w([]);ve("all-users-online",p);const M=w(!1),x=w("");let k=!1;const V=v(()=>y.getters["user/isProgressStatusUserInfo"]),L=v(()=>y.getters["chat/isProgressStatusMessages"]);v(()=>y.getters["chat/isProgressStatusSelectedChat"]);const u=v(()=>y.getters["chat/selectedChatId"]),R=v(()=>y.getters["chat/currentChatMessages"]),G=v(()=>y.getters["chat/currentChat"]),W=v(()=>{var f;return(f=e.currentUser)==null?void 0:f.chats.includes(u.value)}),K=(f,U,N)=>({chatId:f,username:U,userId:N}),re=()=>{_.value=!0,t.emit(O.JOIN_CHAT,K(u.value,e.currentUser.username,e.currentUser._id))},ie=()=>{t.emit(O.LEAVE_CHAT,K(u.value,e.currentUser.username,e.currentUser._id))},ce=()=>{k&&clearTimeout(k),M.value=!0,k=setTimeout(()=>M.value=!1,1e3)},le=()=>{t.emit(O.USER_TYPING,K(u.value,e.currentUser.username,e.currentUser._id))},ue=f=>{t.emit(O.NEW_MESSAGE,{chatId:u.value,userId:e.currentUser._id,text:f})},F=(f,U="")=>{y.dispatch("setNotify",{type:"info",message:s(f,{username:U})},{root:!0})};return Z(()=>{t.on(T.NEW_USER_JOIN,async({username:f,userId:U,chatId:N})=>{U!==e.currentUser._id&&W.value&&u.value===N?F("User join chat",f):U===e.currentUser._id&&(await y.dispatch("user/getUser",e.currentUser.email),F("Joined chat")),await y.dispatch("chat/getSelectedChat",N),_.value=!1}),t.on(T.USER_LEAVE_CHAT,async({chatId:f,username:U})=>{u.value===f&&W.value&&F("User leave chat",U),await y.dispatch("chat/getSelectedChat",f)}),t.on(T.USER_REFRESH_AFTER_LEAVE_CHAT,async()=>{await y.dispatch("user/getUser",e.currentUser.email),F("Left chat")}),t.on(T.USER_TYPING,({chatId:f,userId:U,username:N})=>{U!==e.currentUser._id&&f===u.value&&(x.value=N,ce())}),t.on(T.NEW_MESSAGE,async f=>{f.chat===u.value&&(y.dispatch("chat/addMessage",j({},f)),await y.dispatch("chat/getPublicChats"))}),t.on(T.USER_ONLINE,({userId:f,username:U})=>{f!==e.currentUser._id&&F("User online",U),t.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:u.value,state:!0})}),t.on(T.USER_OFFLINE,async({userId:f,username:U})=>{f!==e.currentUser._id&&F("User offline",U),t.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:u.value,state:!0})}),t.on(T.FETCH_COUNT_SOCKETS_IN_ROOM,async({chatId:f,count:U,ids:N=[]})=>{f&&u.value===f&&(d.value=U,p.value=N)})}),{selectedChatId:u,currentChatMessages:R,isUserJoin:W,onJoinChat:re,onLeaveChat:ie,onTypingMessage:le,onSendMessage:ue,isTyping:M,isProgressStatusMessages:L,isProgressStatusUserInfo:V,currentChatInfo:G,clientsCount:d,isButtonLoading:_,userTypingName:x,openMobileSidebar:()=>{n("toggle-sidebar")},showInfoChatGroupFromDropdown:i,stateDropdownItem:a,changeStateDropdownItem:g}},components:{ChatMessages:Ge,ChatMessageForm:Xe,NoChatsSelected:nt,SelectedChatInfo:Rt,ChatDropdownActions:Gt}},Kt={class:"bg-white z-10 flex items-center justify-between border-b border-gray-200 p-3 h-16"},Qt={key:1,class:"relative"};function zt(e,n,s,t,d,_){const a=c("app-icon"),i=c("selected-chat-info"),g=c("chat-dropdown-actions"),p=c("app-dropdown"),M=c("no-chats-selected"),x=c("chat-messages"),k=c("chat-message-form");return o(),h("main",null,[r("div",Kt,[s.isSidebarOpen?b("",!0):(o(),S(a,{key:0,icon:"arrow-left",class:"w-5 h-5 text-gray-600 mr-3 cursor-pointer",onClick:t.openMobileSidebar},null,8,["onClick"])),t.selectedChatId&&t.currentChatInfo?(o(),S(i,{key:1,"current-chat-info":t.currentChatInfo,"clients-count":t.clientsCount,"is-typing":t.isTyping,"user-typing-name":t.userTypingName,"show-info-chat-group-from-dropdown":t.stateDropdownItem,onChangeStateDropdownItem:t.changeStateDropdownItem},null,8,["current-chat-info","clients-count","is-typing","user-typing-name","show-info-chat-group-from-dropdown","onChangeStateDropdownItem"])):b("",!0),s.currentUser?(o(),S(p,{key:2,icon:"dots-vertical"},{default:I(()=>[m(g,{"is-join":t.isUserJoin,onLeaveChat:t.onLeaveChat,onShowInfoChatGroupFromDropdown:t.showInfoChatGroupFromDropdown,selectedChatId:t.selectedChatId},null,8,["is-join","onLeaveChat","onShowInfoChatGroupFromDropdown","selectedChatId"])]),_:1})):b("",!0)]),!t.selectedChatId||!s.currentUser?(o(),S(M,{key:0})):(o(),h("div",Qt,[m(x,{"is-progress-status-messages":t.isProgressStatusMessages,messages:t.currentChatMessages,"current-user-id":s.currentUser._id},null,8,["is-progress-status-messages","messages","current-user-id"]),m(k,{onTypingMessage:t.onTypingMessage,onSendMessage:t.onSendMessage,onJoinChat:t.onJoinChat,"is-join":t.isUserJoin,isButtonLoading:t.isButtonLoading,"is-sidebar-open":s.isSidebarOpen},null,8,["onTypingMessage","onSendMessage","onJoinChat","is-join","isButtonLoading","is-sidebar-open"])]))])}var Yt=C(Wt,[["render",zt]]);const Xt={name:"TheSidebar",props:{isActive:Boolean}},Zt={class:"fixed xl:block top-0 left-0 w-64 bg-white h-full border-r border-gray-200"},es={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function ts(e,n,s,t,d,_){return o(),S(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",Zt,[r("div",es,[q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})}var ss=C(Xt,[["render",ts]]);const ns={name:"TheSidebarOverlay"},as={class:"fixed inset-0 bg-black bg-opacity-50 z-30"};function os(e,n,s,t,d,_){return o(),h("div",as)}var oe=C(ns,[["render",os]]);const rs={name:"TheSidebarMobile",emits:["close"],props:{isActive:Boolean},setup(e,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},is={class:"fixed w-64 bg-white h-full z-30"},cs={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function ls(e,n,s,t,d,_){const a=c("the-sidebar-overlay");return o(),h(E,null,[m(H,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(m(a,{onClick:n[0]||(n[0]=i=>e.$emit("close"))},null,512),[[P,s.isActive]])]),_:1}),m(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",is,[r("div",cs,[q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})],64)}var us=C(rs,[["render",ls]]);const ds={name:"TheSidebarSettings",emits:["close"],props:{isActive:Boolean},setup(e,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},_s={class:"fixed w-64 bg-white h-full z-30"},hs={class:"relative"};function ms(e,n,s,t,d,_){const a=c("the-sidebar-overlay"),i=c("app-button-close");return o(),h(E,null,[m(H,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(m(a,{onClick:n[0]||(n[0]=g=>e.$emit("close"))},null,512),[[P,s.isActive]])]),_:1}),m(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",_s,[r("div",hs,[m(i,{onClose:t.close,class:"absolute right-3 top-3"},null,8,["onClose"]),q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})],64)}var gs=C(ds,[["render",ms]]);const fs=()=>{const e=w(!1),n=w(!1),s=w(!1),t=()=>{e.value=!0},d=()=>{e.value&&(e.value=!1),s.value=!0},_=()=>{window.innerWidth>=1024?n.value=!n.value:t()},a=()=>{e.value=!1},i=()=>{s.value=!1};Z(()=>{g(),window.addEventListener("resize",g)});const g=()=>{window.innerWidth<768||window.innerWidth<1024?n.value=!1:(n.value=!0,a())};return{isMobileSidebarOpen:e,isSidebarOpen:n,isSidebarSettingsOpen:s,openMobileSidebar:t,toggleSidebar:_,closeMobileSidebar:a,closeSidebarSettings:i,openSidebarSettings:d,onResize:g}},ps={name:"ChatItem",emits:["select-chat"],props:{chat:{type:Object,required:!0},isSelected:{type:Boolean,default:!1},chatIdsPool:{type:Array,default:()=>[]},currentUser:{type:Object,required:!0}},setup(e,{emit:n}){const{t:s}=X(),t=v(()=>e.chat.users.length),d=v(()=>e.chat.name),_=v(()=>e.chat.lastMessage?e.chat.lastMessage.time:""),a=v(()=>e.chat.lastMessage?e.chat.lastMessage.text:s("No messages")),i=v(()=>{if(!!e.chat.lastMessage)return e.currentUser._id===e.chat.lastMessage.user._id?s("You"):e.chat.lastMessage.user.username}),g=v(()=>e.isSelected),p=()=>{n("select-chat",e.chat._id)},M=v(()=>e.chatIdsPool.includes(e.chat._id));return{chatName:d,lastMessageTime:_,lastMessageText:a,lastMessageUsername:i,selectedChat:g,selectChat:p,isNewMessageInCurrentChat:M,countUsers:t}}},vs={class:"ml-2 w-full truncate"},ys={class:"flex justify-between items-center"},Cs={class:"flex items-center gap-1"},bs=["textContent"],Ss=["textContent"],ws={class:"truncate block text-xs"},Us={class:"text-gray-400"};function Is(e,n,s,t,d,_){const a=c("app-avatar"),i=c("app-icon");return o(),h("a",{href:"#",onClick:n[0]||(n[0]=B((...g)=>t.selectChat&&t.selectChat(...g),["prevent"])),class:D([[t.selectedChat?"bg-gray-100":"hover:bg-gray-50"],"px-3 py-2 cursor-pointer flex items-center text-sm focus:outline-none transition duration-200 ease-in-out"])},[m(a,{name:t.chatName,classes:["h-12","w-12"]},null,8,["name"]),r("div",vs,[r("div",ys,[r("div",Cs,[m(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("span",{textContent:l(t.chatName),class:"block font-semibold text-base text-gray-600"},null,8,bs)]),t.lastMessageTime?(o(),h("span",{key:0,textContent:l(e.$filters.passedTime(t.lastMessageTime)),class:"block ml-2 text-xs text-gray-600"},null,8,Ss)):b("",!0)]),r("div",ws,[A(r("span",{class:"text-blue-400"},l(t.lastMessageUsername)+": ",513),[[P,t.lastMessageUsername]]),r("span",Us,l(t.lastMessageText),1)])])],2)}var Ms=C(ps,[["render",Is]]);const xs=(e,n)=>{if(n.length){const s=e.filter(t=>t.name.toLowerCase().includes(n.toLowerCase()));return s.length?s:e}return e},Es={name:"ChatsList",emits:["close"],props:{searchQuery:String},setup(e,{emit:n}){const s=ye(),t=J("socket"),d=v(()=>{var u;return(u=xs(y.getters["chat/publicChat"],e.searchQuery))!=null?u:null}),_=v(()=>{var u;return(u=y.getters["user/user"])!=null?u:null}),a=w([]),i=v(()=>y.getters["chat/isProgressStatusSelectedChat"]),g=v(()=>y.getters["chat/selectedChatId"]),p=async u=>{await y.dispatch("chat/selectChat",u),t.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:u,state:!1})},M=async()=>{const u=s.query.chatId;!u||await p(u)},x=u=>a.value.some(R=>R===u),k=async()=>{await y.dispatch("chat/getPublicChats")},V=async u=>{u!==g.value&&(n("close"),await p(u),L(u),se.push({query:{chatId:u}}))},L=u=>{if(!a.value.length)return;const R=a.value.findIndex(G=>G===u);R!==-1&&a.value.splice(R,1)};return Z(async()=>{await k(),await M(),t.on(T.NEW_MESSAGE,u=>{u.chat!==g.value&&(x(u.chat)||a.value.push(u.chat))})}),{chatsList:d,selectChat:V,selectedChatId:g,chatIdsPool:a,isProgressStatusSelectedChat:i,currentUser:_}},components:{ChatItem:Ms}},$s={key:0,class:"overflow-y-auto truncate"},ks={key:1,class:"p-2"};function Ts(e,n,s,t,d,_){const a=c("chat-item");return t.chatsList&&t.currentUser?(o(),h("div",$s,[(o(!0),h(E,null,z(t.chatsList,i=>(o(),S(a,{key:t.chatsList._id,chat:i,"is-selected":t.selectedChatId===i._id,onSelectChat:t.selectChat,"chat-ids-pool":t.chatIdsPool,"current-user":t.currentUser},null,8,["chat","is-selected","onSelectChat","chat-ids-pool","current-user"]))),128))])):(o(),h("span",ks,l(e.$t("No public chats")),1))}var Ns=C(Es,[["render",Ts]]);const Os={name:"Home",setup(){be();const e=J("socket"),n=Ce(),s=v(()=>n.getters["user/user"]),t=w(""),d=w(!0),_=()=>{var a;((a=s.value)==null?void 0:a.chats)&&s.value.chats.length&&e.emit(O.SET_USER_ONLINE,s.value),d.value=!1};return Y(s,a=>{a&&d.value&&_()}),Q(j({},fs()),{searchQuery:t,user:s})},components:{CurrentChat:Yt,TheSidebar:ss,TheSidebarMobile:us,TheSidebarSettings:gs,ChatsList:Ns,UserInfo:ae}},Ls={class:"h-screen min-w-full min-h-full overflow-hidden"};function As(e,n,s,t,d,_){const a=c("app-hamburger"),i=c("app-search"),g=c("chats-list"),p=c("the-sidebar"),M=c("the-sidebar-mobile"),x=c("user-info"),k=c("the-sidebar-settings"),V=c("current-chat");return o(),h("div",Ls,[m(p,{"is-active":e.isSidebarOpen},{header:I(()=>[m(a,{onClick:e.openSidebarSettings},null,8,["onClick"]),m(i,{modelValue:t.searchQuery,"onUpdate:modelValue":n[0]||(n[0]=L=>t.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[m(g,{"search-query":t.searchQuery},null,8,["search-query"])]),_:1},8,["is-active"]),m(M,{"is-active":e.isMobileSidebarOpen,onClose:e.closeMobileSidebar},{header:I(()=>[m(a,{onClick:e.openSidebarSettings},null,8,["onClick"]),m(i,{modelValue:t.searchQuery,"onUpdate:modelValue":n[1]||(n[1]=L=>t.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[m(g,{onClose:e.closeMobileSidebar,"search-query":t.searchQuery},null,8,["onClose","search-query"])]),_:1},8,["is-active","onClose"]),m(k,{"is-active":e.isSidebarSettingsOpen,onClose:e.closeSidebarSettings},{header:I(()=>[t.user?(o(),S(x,{key:0,user:t.user,onClose:e.closeSidebarSettings},null,8,["user","onClose"])):b("",!0)]),body:I(()=>[]),_:1},8,["is-active","onClose"]),r("div",{class:D([e.isSidebarOpen?"ml-64":"ml-0"])},[t.user?(o(),S(V,{key:0,"current-user":t.user,onToggleSidebar:e.toggleSidebar,"is-sidebar-open":e.isSidebarOpen},null,8,["current-user","onToggleSidebar","is-sidebar-open"])):b("",!0)],2)])}var Ps=C(Os,[["render",As]]);export{Ps as default};
