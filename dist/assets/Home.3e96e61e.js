var de=Object.defineProperty,he=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var te=(e,n,s)=>n in e?de(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,j=(e,n)=>{for(var s in n||(n={}))me.call(n,s)&&te(e,s,n[s]);if(ee)for(var s of ee(n))ge.call(n,s)&&te(e,s,n[s]);return e},Q=(e,n)=>he(e,_e(n));import{o,h as m,S as l,a6 as H,r as c,b as r,d as g,a7 as T,P as w,i as v,T as D,X as B,R as b,a as S,w as I,F as E,a8 as fe,a0 as A,$ as z,g as Y,W as pe,e as X,a9 as ve,f as Z,a1 as P,Y as q,Z as G,u as ye,aa as Ce}from"./vendor.e8134c2c.js";import{_ as C,s as y,r as se,u as be}from"./index.e1689975.js";var k={JOIN_CHAT:"join-chat",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",LEAVE_CHAT:"leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room",LOGOUT:"logout"};const Se={name:"EmptyChatMessages"},we={class:"self-center"};function Ue(e,n,s,t,_,u){return o(),m("div",we,l(e.$t("No messages")),1)}var Ie=C(Se,[["render",Ue]]);const ne=()=>{const e=H("all-users-online");return{isOnline:s=>e.value.some(t=>t===s)}},Me={name:"UserInfo",props:{user:{type:Object,required:!0}}},xe={class:"p-3 border-b border-gray-200"},Ee={class:"flex"},Te={class:"mt-3 space-y-1"},$e={class:"text-md font-semibold"},ke={class:"text-sm"},Ne={class:"font-semibold"},Oe={class:"font-semibold"},Le={class:"font-semibold"};function Ae(e,n,s,t,_,u){const a=c("app-avatar");return o(),m("div",xe,[r("div",Ee,[g(a,{name:s.user.username,classes:["h-12","w-12"]},null,8,["name"])]),r("div",Te,[r("div",$e,l(s.user.username),1),r("div",ke,[r("div",null,[r("span",Ne,l(e.$t("Email"))+":",1),T(" "+l(s.user.email),1)]),r("div",null,[r("span",Oe,l(e.$t("Age"))+":",1),T(" "+l(s.user.age),1)]),r("div",null,[r("span",Le,l(e.$t("Gender"))+":",1),T(" "+l(e.$t(e.$filters.ucFirst(s.user.gender))),1)])])])])}var ae=C(Me,[["render",Ae]]);const Re={name:"ChatMessageItem",props:{message:{type:Object,required:!0},isCurrentUserMessage:{type:Boolean,default:!1}},setup(e){const n=w(null),s=v(()=>{var a;return(a=y.getters["chat/currentChat"])!=null?a:null}),t=w(!1),_=v(()=>e.isCurrentUserMessage?null:e.message.user.username),u=()=>{if(s.value.users.length&&e.message.user._id){const a=s.value.users.filter(i=>i._id===e.message.user._id);a&&(n.value=a[0],t.value=!0)}};return Q(j({},ne()),{username:_,showUserInfoModal:u,modal:t,user:n})},components:{UserInfo:ae}},Fe={class:"chat-message"},je={class:"leading-3 text-xs"};function Be(e,n,s,t,_,u){const a=c("app-avatar"),i=c("user-info"),h=c("app-modal");return o(),m(E,null,[r("div",Fe,[r("div",{class:D(["flex items-end",{"justify-end":s.isCurrentUserMessage}])},[r("div",{class:D([[s.isCurrentUserMessage?"order-1 items-end":"order-2 items-start"],"space-y-2 text-sm"])},[r("div",null,[r("div",{class:D(["px-4 py-2 rounded-lg inline-block flex flex-col items-end max-w-md",[s.isCurrentUserMessage?"rounded-br-none bg-blue-600 text-white":"bg-gray-200 text-gray-600 rounded-bl-none"]])},[t.username?(o(),m("a",{key:0,class:"underline",href:"#",onClick:n[0]||(n[0]=B((...f)=>t.showUserInfoModal&&t.showUserInfoModal(...f),["prevent"]))},l(t.username),1)):b("",!0),r("div",null,l(s.message.text),1),r("div",je,l(e.$filters.passedTime(s.message.time)),1)],2)])],2),r("div",{class:"relative mr-2 cursor-pointer",onClick:n[1]||(n[1]=(...f)=>t.showUserInfoModal&&t.showUserInfoModal(...f))},[s.isCurrentUserMessage?b("",!0):(o(),S(a,{key:0,name:t.username,"is-online":e.isOnline(s.message.user._id)},null,8,["name","is-online"]))])],2)]),t.modal?(o(),S(h,{key:0,state:t.modal,"onUpdate:state":n[2]||(n[2]=f=>t.modal=f),title:e.$t("Information about user")},{default:I(()=>[t.user?(o(),S(i,{key:0,user:t.user},null,8,["user"])):b("",!0)]),_:1},8,["state","title"])):b("",!0)],64)}var Pe=C(Re,[["render",Be]]);const qe={components:{EmptyChatMessages:Ie,ChatMessageItem:Pe},name:"ChatMessages",props:{messages:{type:Array,default:()=>[]},currentUserId:{type:String,required:!0},isProgressStatusMessages:{type:Boolean}}},Ve={class:"relative flex-1 justify-between flex flex-col h-screen"},De={key:1,class:"chat-messages-area"};function Ge(e,n,s,t,_,u){const a=c("app-loader"),i=c("chat-message-item"),h=c("empty-chat-messages"),f=c("app-bg-pattern"),M=fe("scroll-down");return o(),m("div",Ve,[s.isProgressStatusMessages?(o(),S(a,{key:0})):A((o(),m("div",De,[s.messages.length?(o(!0),m(E,{key:0},z(s.messages,x=>(o(),S(i,{key:x._id,message:x,"is-current-user-message":x.user._id===s.currentUserId},null,8,["message","is-current-user-message"]))),128)):(o(),S(h,{key:1}))])),[[M,s.messages.length]]),g(f)])}var He=C(qe,[["render",Ge]]);const Je={name:"ChatMessageForm",emits:["join-chat","typing-message","send-message"],props:{isJoin:{type:Boolean,required:!0},isButtonLoading:{type:Boolean,required:!0},isSidebarOpen:{type:Boolean}},setup(e,{emit:n}){const s=w(!1),t=w(""),_=()=>{n("send-message",t.value),t.value="",s.value=!0},u=()=>{n("join-chat"),s.value=!0};return Y(t,()=>{n("typing-message")}),{joinChat:u,message:t,sendMessage:_,isFocus:s}}},We={class:"chat-message-form flex justify-center"},Ke={key:1,class:"flex gap-3 grow"},Qe={class:"grow"};function ze(e,n,s,t,_,u){const a=c("app-button"),i=c("app-textarea"),h=c("app-icon");return o(),m("div",We,[s.isJoin?(o(),m("div",Ke,[g(i,{modelValue:t.message,"onUpdate:modelValue":n[0]||(n[0]=f=>t.message=f),modelModifiers:{trim:!0},isFocus:t.isFocus,class:"grow-2",onKeyup:pe(B(t.sendMessage,["exact","prevent"]),["enter"])},null,8,["modelValue","isFocus","onKeyup"]),r("div",Qe,[r("button",{onClick:n[1]||(n[1]=(...f)=>t.sendMessage&&t.sendMessage(...f)),type:"button",class:"chat-message-button"},[g(h,{icon:"paper-airplane",class:"h-6 w-6 transform rotate-90"})])])])):(o(),S(a,{key:0,isButtonLoading:s.isButtonLoading,onClick:t.joinChat,color:"success",type:"button"},{default:I(()=>[T(l(e.$t("Join chat")),1)]),_:1},8,["isButtonLoading","onClick"]))])}var Ye=C(Je,[["render",ze]]),N={NEW_USER_JOIN:"new-user-join",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",USER_LEAVE_CHAT:"user-leave-chat",USER_OFFLINE:"user-offline",USER_ONLINE:"user-online",USER_REFRESH_AFTER_LEAVE_CHAT:"user-refresh-after-leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room"};const Xe={name:"NoChatsSelected"},Ze={class:"h-screen flex items-center justify-center"},et={class:"container"};function tt(e,n,s,t,_,u){const a=c("app-alert");return o(),m("div",Ze,[r("div",et,[g(a,{type:"info"},{default:I(()=>[T(l(e.$t("No chats selected")),1)]),_:1})])])}var st=C(Xe,[["render",tt]]);const nt={name:"ChatUserItem",props:{user:{type:Object,required:!0},isOnline:{type:Boolean,required:!0}}},at={class:"flex items-center gap-3 px-6 py-3 cursor-default hover:bg-gray-100"},ot={class:"relative"},rt={class:"grow"},it={class:"flex items-center gap-1"},ct=["textContent"],lt=["textContent"];function ut(e,n,s,t,_,u){const a=c("app-avatar");return o(),m("div",at,[r("div",ot,[g(a,{name:s.user.username,"is-online":s.isOnline},null,8,["name","is-online"])]),r("div",rt,[r("div",it,[r("span",{textContent:l(s.user.username),class:"block font-semibold text-base text-gray-600"},null,8,ct)]),s.isOnline?(o(),m("div",{key:0,class:"text-sm text-blue-400",textContent:l(e.$t("online"))},null,8,lt)):b("",!0)])])}var dt=C(nt,[["render",ut]]);const ht={components:{ChatUserItem:dt},name:"ChatUsersList",props:{users:{type:Array,required:!0}},setup(){return j({},ne())}};function _t(e,n,s,t,_,u){const a=c("chat-user-item");return o(!0),m(E,null,z(s.users,i=>(o(),S(a,{key:i._id,user:i,"is-online":e.isOnline(i._id)},null,8,["user","is-online"]))),128)}var mt=C(ht,[["render",_t]]);const gt={name:"ChatInfo",props:{chatName:{type:String,required:!0},countUsersChat:{type:Number,required:!0},users:{type:Array,default:()=>[]},clientsCount:{type:Number,required:!0}},components:{ChatUsersList:mt}},ft={class:"flex items-center gap-3 px-6 py-3"},pt={class:"grow"},vt={class:"flex items-center gap-1"},yt=["textContent"],Ct={class:"text-sm text-gray-400"},bt=r("div",{class:"border-b border-solid border-gray-200"},null,-1);function St(e,n,s,t,_,u){const a=c("app-avatar"),i=c("app-icon"),h=c("chat-users-list");return o(),m(E,null,[r("div",ft,[g(a,{name:s.chatName,classes:["w-12","h-12"]},null,8,["name"]),r("div",pt,[r("div",vt,[g(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("span",{textContent:l(s.chatName),class:"block font-semibold text-base text-gray-600"},null,8,yt)]),r("div",Ct,[s.countUsersChat?(o(),m(E,{key:0},[T(l(s.countUsersChat)+" "+l(e.$t("groupMembers")),1)],64)):b("",!0),s.clientsCount?(o(),m(E,{key:1},[T(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)])])]),bt,s.users.length?(o(),S(h,{key:0,users:s.users},null,8,["users"])):b("",!0)],64)}var wt=C(gt,[["render",St]]);const Ut={name:"ChatTyping",props:{userTypingName:String}},It={class:"flex gap-1"},Mt={class:"text-sm text-blue-400"};function xt(e,n,s,t,_,u){const a=c("app-typing-loader");return o(),m("div",It,[g(a),r("div",Mt,l(s.userTypingName)+" "+l(e.$t("typing")),1)])}var Et=C(Ut,[["render",xt]]);const Tt={components:{ChatInfo:wt,ChatTyping:Et},name:"SelectedChatInfo",emits:["change-state-dropdown-item"],props:{currentChatInfo:{type:Object,required:!0},clientsCount:{type:Number,required:!0},isTyping:{type:Boolean,default:!1},userTypingName:{type:String},showInfoChatGroupFromDropdown:{type:Boolean}},setup(e,{emit:n}){const s=w(!1),t=v(()=>e.currentChatInfo.name),_=v(()=>e.currentChatInfo.users.length),u=()=>{s.value=!0},a=i=>{s.value=i,n("change-state-dropdown-item",!i)};return Y(()=>e.showInfoChatGroupFromDropdown,i=>{i&&a(i)}),{chatName:t,countUsersChat:_,modal:s,showModalInfo:u}}},$t={class:"font-bold text-base text-gray-600"},kt={class:"h-5"},Nt={key:1,class:"text-sm text-gray-400"},Ot={key:1};function Lt(e,n,s,t,_,u){const a=c("chat-typing"),i=c("chat-info"),h=c("app-modal");return o(),m(E,null,[r("div",null,[r("div",$t,l(t.chatName),1),r("div",kt,[s.isTyping?(o(),S(a,{key:0,"user-typing-name":s.userTypingName},null,8,["user-typing-name"])):(o(),m("div",Nt,[t.countUsersChat?(o(),m("div",{key:0,class:"cursor-pointer",onClick:n[0]||(n[0]=(...f)=>t.showModalInfo&&t.showModalInfo(...f))},[T(l(t.countUsersChat)+" "+l(e.$t("groupMembers"))+" ",1),s.clientsCount?(o(),m(E,{key:0},[T(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)])):(o(),m("div",Ot,[T(l(t.countUsersChat)+" "+l(e.$t("groupMembers"))+" ",1),s.clientsCount?(o(),m(E,{key:0},[T(" , "+l(s.clientsCount)+" "+l(e.$t("online")),1)],64)):b("",!0)]))]))])]),t.modal?(o(),S(h,{key:0,state:t.modal,"onUpdate:state":n[1]||(n[1]=f=>t.modal=f),title:e.$t("Information about chat group")},{default:I(()=>[g(i,{"chat-name":t.chatName,"count-users-chat":t.countUsersChat,users:s.currentChatInfo.users,"clients-count":s.clientsCount},null,8,["chat-name","count-users-chat","users","clients-count"])]),_:1},8,["state","title"])):b("",!0)],64)}var At=C(Tt,[["render",Lt]]);const Rt=()=>{const{t:e}=X();return{logout:async()=>{await y.dispatch("auth/logout"),se.push({name:"login"}),y.dispatch("setNotify",{type:"success",message:e("Logout Message")},{root:!0})}}},Ft={name:"ChatDropdownActions",emits:["leave-chat","show-info-chat-group-from-dropdown"],props:{isJoin:{type:Boolean,required:!0},selectedChatId:{type:String}},setup(){return j({},Rt())}},jt={class:"list-none overflow-hidden py-2"},Bt={key:0},Pt=["textContent"],qt={key:1},Vt=["textContent"],Dt=["textContent"];function Gt(e,n,s,t,_,u){return o(),m("ul",jt,[s.selectedChatId?(o(),m("li",Bt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[0]||(n[0]=B(a=>e.$emit("show-info-chat-group-from-dropdown",!0),["prevent"])),textContent:l(e.$t("Information about chat group"))},null,8,Pt)])):b("",!0),s.isJoin?(o(),m("li",qt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[1]||(n[1]=B(a=>e.$emit("leave-chat"),["prevent"])),textContent:l(e.$t("Leave chat"))},null,8,Vt)])):b("",!0),r("li",null,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[2]||(n[2]=B((...a)=>e.logout&&e.logout(...a),["prevent"])),textContent:l(e.$t("Logout"))},null,8,Dt)])])}var Ht=C(Ft,[["render",Gt]]);const Jt={name:"CurrentChat",emits:["toggle-sidebar"],props:{isSidebarOpen:Boolean,currentUser:{type:Object,required:!0}},setup(e,{emit:n}){const{t:s}=X(),t=H("socket"),_=w(0),u=w(!1),a=w(!1),i=p=>{a.value=p},h=p=>{a.value=p},f=w([]);ve("all-users-online",f);const M=w(!1),x=w("");let $=!1;const V=v(()=>y.getters["user/isProgressStatusUserInfo"]),L=v(()=>y.getters["chat/isProgressStatusMessages"]);v(()=>y.getters["chat/isProgressStatusSelectedChat"]);const d=v(()=>y.getters["chat/selectedChatId"]),R=v(()=>y.getters["chat/currentChatMessages"]),J=v(()=>y.getters["chat/currentChat"]),W=v(()=>{var p;return(p=e.currentUser)==null?void 0:p.chats.includes(d.value)}),K=(p,U,O)=>({chatId:p,username:U,userId:O}),re=()=>{u.value=!0,t.emit(k.JOIN_CHAT,K(d.value,e.currentUser.username,e.currentUser._id))},ie=()=>{t.emit(k.LEAVE_CHAT,K(d.value,e.currentUser.username,e.currentUser._id))},ce=()=>{$&&clearTimeout($),M.value=!0,$=setTimeout(()=>M.value=!1,1e3)},le=()=>{t.emit(k.USER_TYPING,K(d.value,e.currentUser.username,e.currentUser._id))},ue=p=>{t.emit(k.NEW_MESSAGE,{chatId:d.value,userId:e.currentUser._id,text:p})},F=(p,U="")=>{y.dispatch("setNotify",{type:"info",message:s(p,{username:U})},{root:!0})};return Z(()=>{t.on(N.NEW_USER_JOIN,async({username:p,userId:U,chatId:O})=>{U!==e.currentUser._id&&W.value&&d.value===O?F("User join chat",p):U===e.currentUser._id&&(await y.dispatch("user/getUser",e.currentUser.email),F("Joined chat")),await y.dispatch("chat/getSelectedChat",O),u.value=!1}),t.on(N.USER_LEAVE_CHAT,async({chatId:p,username:U})=>{d.value===p&&W.value&&F("User leave chat",U),await y.dispatch("chat/getSelectedChat",p)}),t.on(N.USER_REFRESH_AFTER_LEAVE_CHAT,async()=>{await y.dispatch("user/getUser",e.currentUser.email),F("Left chat")}),t.on(N.USER_TYPING,({chatId:p,userId:U,username:O})=>{U!==e.currentUser._id&&p===d.value&&(x.value=O,ce())}),t.on(N.NEW_MESSAGE,async p=>{p.chat===d.value&&(y.dispatch("chat/addMessage",j({},p)),await y.dispatch("chat/getPublicChats"))}),t.on(N.USER_ONLINE,({userId:p,username:U})=>{p!==e.currentUser._id&&F("User online",U),t.emit(k.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:d.value,state:!0})}),t.on(N.USER_OFFLINE,async({userId:p,username:U})=>{p!==e.currentUser._id&&F("User offline",U),t.emit(k.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:d.value,state:!0})}),t.on(N.FETCH_COUNT_SOCKETS_IN_ROOM,async({chatId:p,count:U,ids:O=[]})=>{p&&d.value===p&&(_.value=U,f.value=O)})}),{selectedChatId:d,currentChatMessages:R,isUserJoin:W,onJoinChat:re,onLeaveChat:ie,onTypingMessage:le,onSendMessage:ue,isTyping:M,isProgressStatusMessages:L,isProgressStatusUserInfo:V,currentChatInfo:J,clientsCount:_,isButtonLoading:u,userTypingName:x,openMobileSidebar:()=>{n("toggle-sidebar")},showInfoChatGroupFromDropdown:i,stateDropdownItem:a,changeStateDropdownItem:h}},components:{ChatMessages:He,ChatMessageForm:Ye,NoChatsSelected:st,SelectedChatInfo:At,ChatDropdownActions:Ht}},Wt={class:"bg-white z-10 flex items-center justify-between border-b border-gray-200 p-3 h-16"},Kt={key:1,class:"relative"};function Qt(e,n,s,t,_,u){const a=c("app-icon"),i=c("selected-chat-info"),h=c("chat-dropdown-actions"),f=c("app-dropdown"),M=c("no-chats-selected"),x=c("chat-messages"),$=c("chat-message-form");return o(),m("main",null,[r("div",Wt,[s.isSidebarOpen?b("",!0):(o(),S(a,{key:0,icon:"arrow-left",class:"w-5 h-5 text-gray-600 mr-3 cursor-pointer",onClick:t.openMobileSidebar},null,8,["onClick"])),t.selectedChatId&&t.currentChatInfo?(o(),S(i,{key:1,"current-chat-info":t.currentChatInfo,"clients-count":t.clientsCount,"is-typing":t.isTyping,"user-typing-name":t.userTypingName,"show-info-chat-group-from-dropdown":t.stateDropdownItem,onChangeStateDropdownItem:t.changeStateDropdownItem},null,8,["current-chat-info","clients-count","is-typing","user-typing-name","show-info-chat-group-from-dropdown","onChangeStateDropdownItem"])):b("",!0),s.currentUser?(o(),S(f,{key:2,icon:"dots-vertical"},{default:I(()=>[g(h,{"is-join":t.isUserJoin,onLeaveChat:t.onLeaveChat,onShowInfoChatGroupFromDropdown:t.showInfoChatGroupFromDropdown,selectedChatId:t.selectedChatId},null,8,["is-join","onLeaveChat","onShowInfoChatGroupFromDropdown","selectedChatId"])]),_:1})):b("",!0)]),!t.selectedChatId||!s.currentUser?(o(),S(M,{key:0})):(o(),m("div",Kt,[g(x,{"is-progress-status-messages":t.isProgressStatusMessages,messages:t.currentChatMessages,"current-user-id":s.currentUser._id},null,8,["is-progress-status-messages","messages","current-user-id"]),g($,{onTypingMessage:t.onTypingMessage,onSendMessage:t.onSendMessage,onJoinChat:t.onJoinChat,"is-join":t.isUserJoin,isButtonLoading:t.isButtonLoading,"is-sidebar-open":s.isSidebarOpen},null,8,["onTypingMessage","onSendMessage","onJoinChat","is-join","isButtonLoading","is-sidebar-open"])]))])}var zt=C(Jt,[["render",Qt]]);const Yt={name:"TheSidebar",props:{isActive:Boolean}},Xt={class:"fixed xl:block top-0 left-0 w-64 bg-white h-full border-r border-gray-200"},Zt={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function es(e,n,s,t,_,u){return o(),S(G,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",Xt,[r("div",Zt,[q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})}var ts=C(Yt,[["render",es]]);const ss={name:"TheSidebarOverlay"},ns={class:"fixed inset-0 bg-black bg-opacity-50 z-30"};function as(e,n,s,t,_,u){return o(),m("div",ns)}var oe=C(ss,[["render",as]]);const os={name:"TheSidebarMobile",emits:["close"],props:{isActive:Boolean},setup(e,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},rs={class:"fixed w-64 bg-white h-full z-30"},is={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function cs(e,n,s,t,_,u){const a=c("the-sidebar-overlay");return o(),m(E,null,[g(G,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(g(a,{onClick:n[0]||(n[0]=i=>e.$emit("close"))},null,512),[[P,s.isActive]])]),_:1}),g(G,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",rs,[r("div",is,[q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})],64)}var ls=C(os,[["render",cs]]);const us={name:"TheSidebarSettings",emits:["close"],props:{isActive:Boolean},setup(e,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},ds={class:"fixed w-64 bg-white h-full z-30"},hs={class:"relative"};function _s(e,n,s,t,_,u){const a=c("the-sidebar-overlay"),i=c("app-button-close");return o(),m(E,null,[g(G,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(g(a,{onClick:n[0]||(n[0]=h=>e.$emit("close"))},null,512),[[P,s.isActive]])]),_:1}),g(G,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",ds,[r("div",hs,[g(i,{onClose:t.close,class:"absolute right-3 top-3"},null,8,["onClose"]),q(e.$slots,"header")]),q(e.$slots,"body")],512),[[P,s.isActive]])]),_:3})],64)}var ms=C(us,[["render",_s]]);const gs=()=>{const e=w(!1),n=w(!1),s=w(!1),t=()=>{e.value=!0},_=()=>{e.value&&(e.value=!1),s.value=!0},u=()=>{window.innerWidth>=1024?n.value=!n.value:t()},a=()=>{e.value=!1},i=()=>{s.value=!1};Z(()=>{h(),window.addEventListener("resize",h)});const h=()=>{window.innerWidth<768||window.innerWidth<1024?n.value=!1:(n.value=!0,a())};return{isMobileSidebarOpen:e,isSidebarOpen:n,isSidebarSettingsOpen:s,openMobileSidebar:t,toggleSidebar:u,closeMobileSidebar:a,closeSidebarSettings:i,openSidebarSettings:_,onResize:h}},fs={name:"ChatItem",emits:["select-chat"],props:{chat:{type:Object,required:!0},isSelected:{type:Boolean,default:!1},chatIdsPool:{type:Array,default:()=>[]},currentUser:{type:Object,required:!0}},setup(e,{emit:n}){const{t:s}=X(),t=v(()=>e.chat.users.length),_=v(()=>e.chat.name),u=v(()=>e.chat.lastMessage?e.chat.lastMessage.time:""),a=v(()=>e.chat.lastMessage?e.chat.lastMessage.text:s("No messages")),i=v(()=>{if(!!e.chat.lastMessage)return e.currentUser._id===e.chat.lastMessage.user._id?s("You"):e.chat.lastMessage.user.username}),h=v(()=>e.isSelected),f=()=>{n("select-chat",e.chat._id)},M=v(()=>e.chatIdsPool.includes(e.chat._id));return{chatName:_,lastMessageTime:u,lastMessageText:a,lastMessageUsername:i,selectedChat:h,selectChat:f,isNewMessageInCurrentChat:M,countUsers:t}}},ps={class:"ml-2 w-full overflow-hidden"},vs={class:"flex justify-between items-center"},ys={class:"flex items-center gap-1"},Cs=["textContent"],bs=["textContent"],Ss={class:"truncate block text-xs"},ws={class:"text-gray-400"};function Us(e,n,s,t,_,u){const a=c("app-avatar"),i=c("app-icon");return o(),m("a",{href:"#",onClick:n[0]||(n[0]=B((...h)=>t.selectChat&&t.selectChat(...h),["prevent"])),class:D([[t.selectedChat?"bg-gray-100":"hover:bg-gray-50"],"px-3 py-2 cursor-pointer flex items-center text-sm focus:outline-none transition duration-200 ease-in-out"])},[g(a,{name:t.chatName,classes:["h-12","w-12"]},null,8,["name"]),r("div",ps,[r("div",vs,[r("div",ys,[g(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("div",{textContent:l(t.chatName),class:"font-semibold text-base text-gray-600 truncate"},null,8,Cs)]),t.lastMessageTime?(o(),m("span",{key:0,textContent:l(e.$filters.passedTime(t.lastMessageTime)),class:"block ml-2 text-xs text-gray-600 truncate"},null,8,bs)):b("",!0)]),r("div",Ss,[A(r("span",{class:"text-blue-400"},l(t.lastMessageUsername)+": ",513),[[P,t.lastMessageUsername]]),r("span",ws,l(t.lastMessageText),1)])])],2)}var Is=C(fs,[["render",Us]]);const Ms=(e,n)=>{if(n.length){const s=e.filter(t=>t.name.toLowerCase().includes(n.toLowerCase()));return s.length?s:e}return e},xs={name:"ChatsList",emits:["close"],props:{searchQuery:String},setup(e,{emit:n}){const s=ye(),t=H("socket"),_=v(()=>{var d;return(d=Ms(y.getters["chat/publicChat"],e.searchQuery))!=null?d:null}),u=v(()=>{var d;return(d=y.getters["user/user"])!=null?d:null}),a=w([]),i=v(()=>y.getters["chat/isProgressStatusSelectedChat"]),h=v(()=>y.getters["chat/selectedChatId"]),f=async d=>{await y.dispatch("chat/selectChat",d),t.emit(k.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:d,state:!1})},M=async()=>{const d=s.query.chatId;!d||await f(d)},x=d=>a.value.some(R=>R===d),$=async()=>{await y.dispatch("chat/getPublicChats")},V=async d=>{d!==h.value&&(n("close"),await f(d),L(d),se.push({query:{chatId:d}}))},L=d=>{if(!a.value.length)return;const R=a.value.findIndex(J=>J===d);R!==-1&&a.value.splice(R,1)};return Z(async()=>{await $(),await M(),t.on(N.NEW_MESSAGE,d=>{d.chat!==h.value&&(x(d.chat)||a.value.push(d.chat))})}),{chatsList:_,selectChat:V,selectedChatId:h,chatIdsPool:a,isProgressStatusSelectedChat:i,currentUser:u}},components:{ChatItem:Is}},Es={key:1,class:"p-2"};function Ts(e,n,s,t,_,u){const a=c("chat-item");return t.chatsList&&t.currentUser?(o(!0),m(E,{key:0},z(t.chatsList,i=>(o(),S(a,{key:t.chatsList._id,chat:i,"is-selected":t.selectedChatId===i._id,onSelectChat:t.selectChat,"chat-ids-pool":t.chatIdsPool,"current-user":t.currentUser},null,8,["chat","is-selected","onSelectChat","chat-ids-pool","current-user"]))),128)):(o(),m("span",Es,l(e.$t("No public chats")),1))}var $s=C(xs,[["render",Ts]]);const ks={name:"Home",setup(){be();const e=H("socket"),n=Ce(),s=v(()=>n.getters["user/user"]),t=w(""),_=v(()=>s.value?s.value._id:null),u=w(!0),a=()=>{var h;((h=s.value)==null?void 0:h.chats)&&s.value.chats.length&&e.emit(k.SET_USER_ONLINE,s.value),u.value=!1},i=()=>{e.emit(k.LOGOUT,_.value)};return Y(s,h=>{h&&u.value&&a()}),n.watch((h,f)=>f["auth/isLoggedIn"],h=>{h===!1&&i()}),Q(j({},gs()),{searchQuery:t,user:s})},components:{CurrentChat:zt,TheSidebar:ts,TheSidebarMobile:ls,TheSidebarSettings:ms,ChatsList:$s,UserInfo:ae}},Ns={class:"h-screen min-w-full min-h-full overflow-hidden"};function Os(e,n,s,t,_,u){const a=c("app-hamburger"),i=c("app-search"),h=c("chats-list"),f=c("the-sidebar"),M=c("the-sidebar-mobile"),x=c("user-info"),$=c("the-sidebar-settings"),V=c("current-chat");return o(),m("div",Ns,[g(f,{"is-active":e.isSidebarOpen},{header:I(()=>[g(a,{onClick:e.openSidebarSettings},null,8,["onClick"]),g(i,{modelValue:t.searchQuery,"onUpdate:modelValue":n[0]||(n[0]=L=>t.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[g(h,{"search-query":t.searchQuery},null,8,["search-query"])]),_:1},8,["is-active"]),g(M,{"is-active":e.isMobileSidebarOpen,onClose:e.closeMobileSidebar},{header:I(()=>[g(a,{onClick:e.openSidebarSettings},null,8,["onClick"]),g(i,{modelValue:t.searchQuery,"onUpdate:modelValue":n[1]||(n[1]=L=>t.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[g(h,{onClose:e.closeMobileSidebar,"search-query":t.searchQuery},null,8,["onClose","search-query"])]),_:1},8,["is-active","onClose"]),g($,{"is-active":e.isSidebarSettingsOpen,onClose:e.closeSidebarSettings},{header:I(()=>[t.user?(o(),S(x,{key:0,user:t.user,onClose:e.closeSidebarSettings},null,8,["user","onClose"])):b("",!0)]),body:I(()=>[]),_:1},8,["is-active","onClose"]),r("div",{class:D([e.isSidebarOpen?"ml-64":"ml-0"])},[t.user?(o(),S(V,{key:0,"current-user":t.user,onToggleSidebar:e.toggleSidebar,"is-sidebar-open":e.isSidebarOpen},null,8,["current-user","onToggleSidebar","is-sidebar-open"])):b("",!0)],2)])}var js=C(ks,[["render",Os]]);export{js as default};
