var de=Object.defineProperty,he=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var te=(t,n,s)=>n in t?de(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,V=(t,n)=>{for(var s in n||(n={}))me.call(n,s)&&te(t,s,n[s]);if(ee)for(var s of ee(n))ge.call(n,s)&&te(t,s,n[s]);return t},Q=(t,n)=>he(t,_e(n));import{o,h as _,O as u,a2 as J,r as c,b as r,d as m,a3 as E,N as w,i as v,P as D,X as j,Q as b,a as S,w as I,F as x,a4 as fe,Y as A,W as z,g as Y,a5 as pe,e as X,a6 as ve,f as Z,Z as B,S as P,T as H,u as ye,a7 as Ce}from"./vendor.e16af399.js";import{_ as C,s as y,r as se,u as be}from"./index.7f2b6ecb.js";var O={JOIN_CHAT:"join-chat",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",LEAVE_CHAT:"leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room"};const Se={name:"EmptyChatMessages"},we={class:"self-center"};function Ue(t,n,s,e,d,h){return o(),_("div",we,u(t.$t("No messages")),1)}var Ie=C(Se,[["render",Ue]]);const ne=()=>{const t=J("all-users-online");return{isOnline:s=>t.value.some(e=>e===s)}},Me={name:"UserInfo",props:{user:{type:Object,required:!0}}},xe={class:"p-3 border-b border-gray-200"},Ee={class:"flex"},ke={class:"mt-3 space-y-1"},Te={class:"text-md font-semibold"},$e={class:"text-sm"},Ne={class:"font-semibold"},Oe={class:"font-semibold"},Le={class:"font-semibold"};function Ae(t,n,s,e,d,h){const a=c("app-avatar");return o(),_("div",xe,[r("div",Ee,[m(a,{name:s.user.username,classes:["h-12","w-12"]},null,8,["name"])]),r("div",ke,[r("div",Te,u(s.user.username),1),r("div",$e,[r("div",null,[r("span",Ne,u(t.$t("Email"))+":",1),E(" "+u(s.user.email),1)]),r("div",null,[r("span",Oe,u(t.$t("Age"))+":",1),E(" "+u(s.user.age),1)]),r("div",null,[r("span",Le,u(t.$t("Gender"))+":",1),E(" "+u(t.$t(t.$filters.ucFirst(s.user.gender))),1)])])])])}var ae=C(Me,[["render",Ae]]);const Re={name:"ChatMessageItem",props:{message:{type:Object,required:!0},isCurrentUserMessage:{type:Boolean,default:!1}},setup(t){const n=w(null),s=v(()=>{var a;return(a=y.getters["chat/currentChat"])!=null?a:null}),e=w(!1),d=v(()=>t.isCurrentUserMessage?null:t.message.user.username),h=()=>{if(s.value.users.length&&t.message.user._id){const a=s.value.users.filter(i=>i._id===t.message.user._id);a&&(n.value=a[0],e.value=!0)}};return Q(V({},ne()),{username:d,showUserInfoModal:h,modal:e,user:n})},components:{UserInfo:ae}},Fe={class:"chat-message"},je={class:"flex flex-col items-end text-xs"};function Be(t,n,s,e,d,h){const a=c("app-avatar"),i=c("user-info"),g=c("app-modal");return o(),_(x,null,[r("div",Fe,[r("div",{class:D(["flex items-end",{"justify-end":s.isCurrentUserMessage}])},[r("div",{class:D([[s.isCurrentUserMessage?"order-1 items-end":"order-2 items-start"],"flex flex-col space-y-2 text-sm max-w-xs"])},[r("div",null,[r("div",{class:D(["px-4 py-2 rounded-lg inline-block",[s.isCurrentUserMessage?"rounded-br-none bg-blue-600 text-white":"bg-gray-200 text-gray-600 rounded-bl-none"]])},[e.username?(o(),_("a",{key:0,class:"underline",href:"#",onClick:n[0]||(n[0]=j((...p)=>e.showUserInfoModal&&e.showUserInfoModal(...p),["prevent"]))},u(e.username),1)):b("",!0),r("div",null,u(s.message.text),1),r("div",je,[r("div",null,u(t.$filters.passedTime(s.message.time)),1)])],2)])],2),r("div",{class:"relative mr-2 cursor-pointer",onClick:n[1]||(n[1]=(...p)=>e.showUserInfoModal&&e.showUserInfoModal(...p))},[s.isCurrentUserMessage?b("",!0):(o(),S(a,{key:0,name:e.username,"is-online":t.isOnline(s.message.user._id)},null,8,["name","is-online"]))])],2)]),e.modal?(o(),S(g,{key:0,state:e.modal,"onUpdate:state":n[2]||(n[2]=p=>e.modal=p),title:t.$t("Information about user")},{default:I(()=>[e.user?(o(),S(i,{key:0,user:e.user},null,8,["user"])):b("",!0)]),_:1},8,["state","title"])):b("",!0)],64)}var Pe=C(Re,[["render",Be]]);const qe={components:{EmptyChatMessages:Ie,ChatMessageItem:Pe},name:"ChatMessages",props:{messages:{type:Array,default:()=>[]},currentUserId:{type:String,required:!0},isProgressStatusMessages:{type:Boolean}}},Ve={class:"flex-1 justify-between flex flex-col h-screen bg-white"},De={key:1,class:"chat-messages-area"};function He(t,n,s,e,d,h){const a=c("app-loader"),i=c("chat-message-item"),g=c("empty-chat-messages"),p=fe("scroll-down");return o(),_("div",Ve,[s.isProgressStatusMessages?(o(),S(a,{key:0})):A((o(),_("div",De,[s.messages.length?(o(!0),_(x,{key:0},z(s.messages,M=>(o(),S(i,{key:M._id,message:M,"is-current-user-message":M.user._id===s.currentUserId},null,8,["message","is-current-user-message"]))),128)):(o(),S(g,{key:1}))])),[[p,s.messages.length]])])}var Je=C(qe,[["render",He]]);const Ge={name:"ChatMessageForm",emits:["join-chat","typing-message","send-message"],props:{isJoin:{type:Boolean,required:!0},isButtonLoading:{type:Boolean,required:!0},isSidebarOpen:{type:Boolean}},setup(t,{emit:n}){const s=w(!1),e=w(""),d=()=>{n("send-message",e.value),e.value="",s.value=!0},h=()=>{n("join-chat"),s.value=!0};return Y(e,()=>{n("typing-message")}),{joinChat:h,message:e,sendMessage:d,isFocus:s}}},We={class:"chat-message-form flex justify-center"},Ke={key:1,class:"flex gap-3 grow"},Qe={class:"grow"};function ze(t,n,s,e,d,h){const a=c("app-button"),i=c("app-textarea"),g=c("app-icon");return o(),_("div",We,[s.isJoin?(o(),_("div",Ke,[m(i,{modelValue:e.message,"onUpdate:modelValue":n[0]||(n[0]=p=>e.message=p),modelModifiers:{trim:!0},isFocus:e.isFocus,class:"grow-2",onKeyup:pe(j(e.sendMessage,["exact","prevent"]),["enter"])},null,8,["modelValue","isFocus","onKeyup"]),r("div",Qe,[r("button",{onClick:n[1]||(n[1]=(...p)=>e.sendMessage&&e.sendMessage(...p)),type:"button",class:"chat-message-button"},[m(g,{icon:"paper-airplane",class:"h-6 w-6 transform rotate-90"})])])])):(o(),S(a,{key:0,isButtonLoading:s.isButtonLoading,onClick:e.joinChat,color:"success",type:"button"},{default:I(()=>[E(u(t.$t("Join chat")),1)]),_:1},8,["isButtonLoading","onClick"]))])}var Ye=C(Ge,[["render",ze]]),T={NEW_USER_JOIN:"new-user-join",USER_TYPING:"user-typing",NEW_MESSAGE:"new-message",USER_LEAVE_CHAT:"user-leave-chat",USER_OFFLINE:"user-offline",USER_ONLINE:"user-online",USER_REFRESH_AFTER_LEAVE_CHAT:"user-refresh-after-leave-chat",SET_USER_ONLINE:"set-user-online",FETCH_COUNT_SOCKETS_IN_ROOM:"fetch-count-sockets-in-room"};const Xe={name:"NoChatsSelected"},Ze={class:"h-screen flex items-center justify-center"},et={class:"container"};function tt(t,n,s,e,d,h){const a=c("app-alert");return o(),_("div",Ze,[r("div",et,[m(a,{type:"info"},{default:I(()=>[E(u(t.$t("No chats selected")),1)]),_:1})])])}var st=C(Xe,[["render",tt]]);const nt={name:"ChatUserItem",props:{user:{type:Object,required:!0},isOnline:{type:Boolean,required:!0}}},at={class:"flex items-center gap-3 px-6 py-3 cursor-default hover:bg-gray-100"},ot={class:"relative"},rt={class:"grow"},it={class:"flex items-center gap-1"},ct=["textContent"],lt=["textContent"];function ut(t,n,s,e,d,h){const a=c("app-avatar");return o(),_("div",at,[r("div",ot,[m(a,{name:s.user.username,"is-online":s.isOnline},null,8,["name","is-online"])]),r("div",rt,[r("div",it,[r("span",{textContent:u(s.user.username),class:"block font-semibold text-base text-gray-600"},null,8,ct)]),s.isOnline?(o(),_("div",{key:0,class:"text-sm text-blue-400",textContent:u(t.$t("online"))},null,8,lt)):b("",!0)])])}var dt=C(nt,[["render",ut]]);const ht={components:{ChatUserItem:dt},name:"ChatUsersList",props:{users:{type:Array,required:!0}},setup(){return V({},ne())}};function _t(t,n,s,e,d,h){const a=c("chat-user-item");return o(!0),_(x,null,z(s.users,i=>(o(),S(a,{key:i._id,user:i,"is-online":t.isOnline(i._id)},null,8,["user","is-online"]))),128)}var mt=C(ht,[["render",_t]]);const gt={name:"ChatInfo",props:{chatName:{type:String,required:!0},countUsersChat:{type:Number,required:!0},users:{type:Array,default:()=>[]},clientsCount:{type:Number,required:!0}},components:{ChatUsersList:mt}},ft={class:"flex items-center gap-3 px-6 py-3"},pt={class:"grow"},vt={class:"flex items-center gap-1"},yt=["textContent"],Ct={class:"text-sm text-gray-400"},bt=r("div",{class:"border-b border-solid border-gray-200"},null,-1);function St(t,n,s,e,d,h){const a=c("app-avatar"),i=c("app-icon"),g=c("chat-users-list");return o(),_(x,null,[r("div",ft,[m(a,{name:s.chatName,classes:["w-12","h-12"]},null,8,["name"]),r("div",pt,[r("div",vt,[m(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("span",{textContent:u(s.chatName),class:"block font-semibold text-base text-gray-600"},null,8,yt)]),r("div",Ct,[s.countUsersChat?(o(),_(x,{key:0},[E(u(s.countUsersChat)+" "+u(t.$t("groupMembers")),1)],64)):b("",!0),s.clientsCount?(o(),_(x,{key:1},[E(" , "+u(s.clientsCount)+" "+u(t.$t("online")),1)],64)):b("",!0)])])]),bt,s.users.length?(o(),S(g,{key:0,users:s.users},null,8,["users"])):b("",!0)],64)}var wt=C(gt,[["render",St]]);const Ut={name:"ChatTyping",props:{userTypingName:String}},It={class:"flex gap-1"},Mt={class:"text-sm text-blue-400"};function xt(t,n,s,e,d,h){const a=c("app-typing-loader");return o(),_("div",It,[m(a),r("div",Mt,u(s.userTypingName)+" "+u(t.$t("typing")),1)])}var Et=C(Ut,[["render",xt]]);const kt={components:{ChatInfo:wt,ChatTyping:Et},name:"SelectedChatInfo",emits:["change-state-dropdown-item"],props:{currentChatInfo:{type:Object,required:!0},clientsCount:{type:Number,required:!0},isTyping:{type:Boolean,default:!1},userTypingName:{type:String},showInfoChatGroupFromDropdown:{type:Boolean}},setup(t,{emit:n}){const s=w(!1),e=v(()=>t.currentChatInfo.name),d=v(()=>t.currentChatInfo.users.length),h=()=>{s.value=!0},a=i=>{s.value=i,n("change-state-dropdown-item",!i)};return Y(()=>t.showInfoChatGroupFromDropdown,i=>{i&&a(i)}),{chatName:e,countUsersChat:d,modal:s,showModalInfo:h}}},Tt={class:"font-bold text-base text-gray-600"},$t={class:"h-5"},Nt={key:1,class:"text-sm text-gray-400"},Ot={key:1};function Lt(t,n,s,e,d,h){const a=c("chat-typing"),i=c("chat-info"),g=c("app-modal");return o(),_(x,null,[r("div",null,[r("div",Tt,u(e.chatName),1),r("div",$t,[s.isTyping?(o(),S(a,{key:0,"user-typing-name":s.userTypingName},null,8,["user-typing-name"])):(o(),_("div",Nt,[e.countUsersChat?(o(),_("div",{key:0,class:"cursor-pointer",onClick:n[0]||(n[0]=(...p)=>e.showModalInfo&&e.showModalInfo(...p))},[E(u(e.countUsersChat)+" "+u(t.$t("groupMembers"))+" ",1),s.clientsCount?(o(),_(x,{key:0},[E(" , "+u(s.clientsCount)+" "+u(t.$t("online")),1)],64)):b("",!0)])):(o(),_("div",Ot,[E(u(e.countUsersChat)+" "+u(t.$t("groupMembers"))+" ",1),s.clientsCount?(o(),_(x,{key:0},[E(" , "+u(s.clientsCount)+" "+u(t.$t("online")),1)],64)):b("",!0)]))]))])]),e.modal?(o(),S(g,{key:0,state:e.modal,"onUpdate:state":n[1]||(n[1]=p=>e.modal=p),title:t.$t("Information about chat group")},{default:I(()=>[m(i,{"chat-name":e.chatName,"count-users-chat":e.countUsersChat,users:s.currentChatInfo.users,"clients-count":s.clientsCount},null,8,["chat-name","count-users-chat","users","clients-count"])]),_:1},8,["state","title"])):b("",!0)],64)}var At=C(kt,[["render",Lt]]);const Rt={name:"ChatDropdownActions",emits:["leave-chat","show-info-chat-group-from-dropdown"],props:{isJoin:{type:Boolean,required:!0},selectedChatId:{type:String}},setup(){const{t}=X();return{logout:async()=>{await y.dispatch("auth/logout"),se.push({name:"login"}),y.dispatch("setNotify",{type:"success",message:t("Logout Message")},{root:!0})}}}},Ft={class:"list-none overflow-hidden py-2"},jt={key:0},Bt=["textContent"],Pt={key:1},qt=["textContent"],Vt=["textContent"];function Dt(t,n,s,e,d,h){return o(),_("ul",Ft,[s.selectedChatId?(o(),_("li",jt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[0]||(n[0]=j(a=>t.$emit("show-info-chat-group-from-dropdown",!0),["prevent"])),textContent:u(t.$t("Information about chat group"))},null,8,Bt)])):b("",!0),s.isJoin?(o(),_("li",Pt,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[1]||(n[1]=j(a=>t.$emit("leave-chat"),["prevent"])),textContent:u(t.$t("Leave chat"))},null,8,qt)])):b("",!0),r("li",null,[r("a",{href:"#",class:"transition duration-200 block px-3 py-1 hover:bg-gray-100",onClick:n[2]||(n[2]=j((...a)=>e.logout&&e.logout(...a),["prevent"])),textContent:u(t.$t("Logout"))},null,8,Vt)])])}var Ht=C(Rt,[["render",Dt]]);const Jt={name:"CurrentChat",emits:["toggle-sidebar"],props:{isSidebarOpen:Boolean,currentUser:{type:Object,required:!0}},setup(t,{emit:n}){const{t:s}=X(),e=J("socket"),d=w(0),h=w(!1),a=w(!1),i=f=>{a.value=f},g=f=>{a.value=f},p=w([]);ve("all-users-online",p);const M=w(!1),$=w("");let k=!1;const q=v(()=>y.getters["user/isProgressStatusUserInfo"]),L=v(()=>y.getters["chat/isProgressStatusMessages"]);v(()=>y.getters["chat/isProgressStatusSelectedChat"]);const l=v(()=>y.getters["chat/selectedChatId"]),R=v(()=>y.getters["chat/currentChatMessages"]),G=v(()=>y.getters["chat/currentChat"]),W=v(()=>{var f;return(f=t.currentUser)==null?void 0:f.chats.includes(l.value)}),K=(f,U,N)=>({chatId:f,username:U,userId:N}),re=()=>{h.value=!0,e.emit(O.JOIN_CHAT,K(l.value,t.currentUser.username,t.currentUser._id))},ie=()=>{e.emit(O.LEAVE_CHAT,K(l.value,t.currentUser.username,t.currentUser._id))},ce=()=>{k&&clearTimeout(k),M.value=!0,k=setTimeout(()=>M.value=!1,1e3)},le=()=>{e.emit(O.USER_TYPING,K(l.value,t.currentUser.username,t.currentUser._id))},ue=f=>{e.emit(O.NEW_MESSAGE,{chatId:l.value,userId:t.currentUser._id,text:f})},F=(f,U="")=>{y.dispatch("setNotify",{type:"info",message:s(f,{username:U})},{root:!0})};return Z(()=>{e.on(T.NEW_USER_JOIN,async({username:f,userId:U,chatId:N})=>{U!==t.currentUser._id&&W.value&&l.value===N?F("User join chat",f):U===t.currentUser._id&&(await y.dispatch("user/getUser",t.currentUser.email),F("Joined chat")),await y.dispatch("chat/getSelectedChat",N),h.value=!1}),e.on(T.USER_LEAVE_CHAT,async({chatId:f,username:U})=>{l.value===f&&W.value&&F("User leave chat",U),await y.dispatch("chat/getSelectedChat",f)}),e.on(T.USER_REFRESH_AFTER_LEAVE_CHAT,async()=>{await y.dispatch("user/getUser",t.currentUser.email),F("Left chat")}),e.on(T.USER_TYPING,({chatId:f,userId:U,username:N})=>{U!==t.currentUser._id&&f===l.value&&($.value=N,ce())}),e.on(T.NEW_MESSAGE,async f=>{f.chat===l.value&&(y.dispatch("chat/addMessage",V({},f)),await y.dispatch("chat/getPublicChats"))}),e.on(T.USER_ONLINE,({userId:f,username:U})=>{f!==t.currentUser._id&&F("User online",U),e.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:l.value,state:!0})}),e.on(T.USER_OFFLINE,async({userId:f,username:U})=>{f!==t.currentUser._id&&F("User offline",U),e.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:l.value,state:!0})}),e.on(T.FETCH_COUNT_SOCKETS_IN_ROOM,async({chatId:f,count:U,ids:N=[]})=>{f&&l.value===f&&(d.value=U,p.value=N)})}),{selectedChatId:l,currentChatMessages:R,isUserJoin:W,onJoinChat:re,onLeaveChat:ie,onTypingMessage:le,onSendMessage:ue,isTyping:M,isProgressStatusMessages:L,isProgressStatusUserInfo:q,currentChatInfo:G,clientsCount:d,isButtonLoading:h,userTypingName:$,openMobileSidebar:()=>{n("toggle-sidebar")},showInfoChatGroupFromDropdown:i,stateDropdownItem:a,changeStateDropdownItem:g}},components:{ChatMessages:Je,ChatMessageForm:Ye,NoChatsSelected:st,SelectedChatInfo:At,ChatDropdownActions:Ht}},Gt={class:"bg-white z-10 flex items-center justify-between border-b border-gray-200 p-3 h-16"},Wt={key:1,class:"relative"};function Kt(t,n,s,e,d,h){const a=c("app-icon"),i=c("selected-chat-info"),g=c("chat-dropdown-actions"),p=c("app-dropdown"),M=c("no-chats-selected"),$=c("chat-messages"),k=c("chat-message-form");return o(),_("main",null,[r("div",Gt,[s.isSidebarOpen?b("",!0):(o(),S(a,{key:0,icon:"arrow-left",class:"w-5 h-5 text-gray-600 mr-3 cursor-pointer",onClick:e.openMobileSidebar},null,8,["onClick"])),e.selectedChatId&&e.currentChatInfo?(o(),S(i,{key:1,"current-chat-info":e.currentChatInfo,"clients-count":e.clientsCount,"is-typing":e.isTyping,"user-typing-name":e.userTypingName,"show-info-chat-group-from-dropdown":e.stateDropdownItem,onChangeStateDropdownItem:e.changeStateDropdownItem},null,8,["current-chat-info","clients-count","is-typing","user-typing-name","show-info-chat-group-from-dropdown","onChangeStateDropdownItem"])):b("",!0),s.currentUser?(o(),S(p,{key:2,icon:"dots-vertical"},{default:I(()=>[m(g,{"is-join":e.isUserJoin,onLeaveChat:e.onLeaveChat,onShowInfoChatGroupFromDropdown:e.showInfoChatGroupFromDropdown,selectedChatId:e.selectedChatId},null,8,["is-join","onLeaveChat","onShowInfoChatGroupFromDropdown","selectedChatId"])]),_:1})):b("",!0)]),!e.selectedChatId||!s.currentUser?(o(),S(M,{key:0})):(o(),_("div",Wt,[m($,{"is-progress-status-messages":e.isProgressStatusMessages,messages:e.currentChatMessages,"current-user-id":s.currentUser._id},null,8,["is-progress-status-messages","messages","current-user-id"]),m(k,{onTypingMessage:e.onTypingMessage,onSendMessage:e.onSendMessage,onJoinChat:e.onJoinChat,"is-join":e.isUserJoin,isButtonLoading:e.isButtonLoading,"is-sidebar-open":s.isSidebarOpen},null,8,["onTypingMessage","onSendMessage","onJoinChat","is-join","isButtonLoading","is-sidebar-open"])]))])}var Qt=C(Jt,[["render",Kt]]);const zt={name:"TheSidebar",props:{isActive:Boolean}},Yt={class:"fixed xl:block top-0 left-0 w-64 bg-white h-full border-r border-gray-200"},Xt={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function Zt(t,n,s,e,d,h){return o(),S(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",Yt,[r("div",Xt,[P(t.$slots,"header")]),P(t.$slots,"body")],512),[[B,s.isActive]])]),_:3})}var es=C(zt,[["render",Zt]]);const ts={name:"TheSidebarOverlay"},ss={class:"fixed inset-0 bg-black bg-opacity-50 z-30"};function ns(t,n,s,e,d,h){return o(),_("div",ss)}var oe=C(ts,[["render",ns]]);const as={name:"TheSidebarMobile",emits:["close"],props:{isActive:Boolean},setup(t,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},os={class:"fixed w-64 bg-white h-full z-30"},rs={class:"flex h-16 p-3 items-center border-b border-gray-200 gap-3"};function is(t,n,s,e,d,h){const a=c("the-sidebar-overlay");return o(),_(x,null,[m(H,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(m(a,{onClick:n[0]||(n[0]=i=>t.$emit("close"))},null,512),[[B,s.isActive]])]),_:1}),m(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",os,[r("div",rs,[P(t.$slots,"header")]),P(t.$slots,"body")],512),[[B,s.isActive]])]),_:3})],64)}var cs=C(as,[["render",is]]);const ls={name:"TheSidebarSettings",emits:["close"],props:{isActive:Boolean},setup(t,{emit:n}){return{close:()=>{n("close")}}},components:{TheSidebarOverlay:oe}},us={class:"fixed w-64 bg-white h-full z-30"},ds={class:"relative"};function hs(t,n,s,e,d,h){const a=c("the-sidebar-overlay"),i=c("app-button-close");return o(),_(x,null,[m(H,{"enter-active-class":"transition-opacity ease-linear duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity ease-linear duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[A(m(a,{onClick:n[0]||(n[0]=g=>t.$emit("close"))},null,512),[[B,s.isActive]])]),_:1}),m(H,{"enter-active-class":"transition ease-in-out duration-200 transform","enter-from-class":"-translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition ease-in-out duration-200 transform","leave-from-class":"translate-x-0","leave-to-class":"-translate-x-full"},{default:I(()=>[A(r("div",us,[r("div",ds,[m(i,{onClose:e.close,class:"absolute right-3 top-3"},null,8,["onClose"]),P(t.$slots,"header")]),P(t.$slots,"body")],512),[[B,s.isActive]])]),_:3})],64)}var _s=C(ls,[["render",hs]]);const ms=()=>{const t=w(!1),n=w(!1),s=w(!1),e=()=>{t.value=!0},d=()=>{t.value&&(t.value=!1),s.value=!0},h=()=>{window.innerWidth>=1024?n.value=!n.value:e()},a=()=>{t.value=!1},i=()=>{s.value=!1};Z(()=>{g(),window.addEventListener("resize",g)});const g=()=>{window.innerWidth<768||window.innerWidth<1024?n.value=!1:(n.value=!0,a())};return{isMobileSidebarOpen:t,isSidebarOpen:n,isSidebarSettingsOpen:s,openMobileSidebar:e,toggleSidebar:h,closeMobileSidebar:a,closeSidebarSettings:i,openSidebarSettings:d,onResize:g}},gs={name:"ChatItem",emits:["select-chat"],props:{chat:{type:Object,required:!0},isSelected:{type:Boolean,default:!1},chatIdsPool:{type:Array,default:()=>[]},currentUser:{type:Object,required:!0}},setup(t,{emit:n}){const{t:s}=X(),e=v(()=>t.chat.users.length),d=v(()=>t.chat.name),h=v(()=>t.chat.lastMessage?t.chat.lastMessage.time:""),a=v(()=>t.chat.lastMessage?t.chat.lastMessage.text:s("No messages")),i=v(()=>{if(!!t.chat.lastMessage)return t.currentUser._id===t.chat.lastMessage.user._id?s("You"):t.chat.lastMessage.user.username}),g=v(()=>t.isSelected),p=()=>{n("select-chat",t.chat._id)},M=v(()=>t.chatIdsPool.includes(t.chat._id));return{chatName:d,lastMessageTime:h,lastMessageText:a,lastMessageUsername:i,selectedChat:g,selectChat:p,isNewMessageInCurrentChat:M,countUsers:e}}},fs={class:"ml-2 w-full truncate"},ps={class:"flex justify-between items-center"},vs={class:"flex items-center gap-1"},ys=["textContent"],Cs=["textContent"],bs={class:"truncate block text-xs"},Ss={class:"text-gray-400"};function ws(t,n,s,e,d,h){const a=c("app-avatar"),i=c("app-icon");return o(),_("a",{href:"#",onClick:n[0]||(n[0]=j((...g)=>e.selectChat&&e.selectChat(...g),["prevent"])),class:D([[e.selectedChat?"bg-gray-100":"hover:bg-gray-50"],"px-3 py-2 cursor-pointer flex items-center text-sm focus:outline-none transition duration-200 ease-in-out"])},[m(a,{name:e.chatName,classes:["h-12","w-12"]},null,8,["name"]),r("div",fs,[r("div",ps,[r("div",vs,[m(i,{icon:"user-group",class:"w-4 h-4 text-gray-600"}),r("span",{textContent:u(e.chatName),class:"block font-semibold text-base text-gray-600"},null,8,ys)]),e.lastMessageTime?(o(),_("span",{key:0,textContent:u(t.$filters.passedTime(e.lastMessageTime)),class:"block ml-2 text-xs text-gray-600"},null,8,Cs)):b("",!0)]),r("div",bs,[A(r("span",{class:"text-blue-400"},u(e.lastMessageUsername)+": ",513),[[B,e.lastMessageUsername]]),r("span",Ss,u(e.lastMessageText),1)])])],2)}var Us=C(gs,[["render",ws]]);const Is=(t,n)=>{if(n.length){const s=t.filter(e=>e.name.toLowerCase().includes(n.toLowerCase()));return s.length?s:t}return t},Ms={name:"ChatsList",emits:["close"],props:{searchQuery:String},setup(t,{emit:n}){const s=ye(),e=J("socket"),d=v(()=>{var l;return(l=Is(y.getters["chat/publicChat"],t.searchQuery))!=null?l:null}),h=v(()=>{var l;return(l=y.getters["user/user"])!=null?l:null}),a=w([]),i=v(()=>y.getters["chat/isProgressStatusSelectedChat"]),g=v(()=>y.getters["chat/selectedChatId"]),p=async l=>{console.log(l),await y.dispatch("chat/selectChat",l),e.emit(O.FETCH_COUNT_SOCKETS_IN_ROOM,{chatId:l,state:!1})},M=async()=>{const l=s.query.chatId;!l||await p(l)},$=l=>a.value.some(R=>R===l),k=async()=>{await y.dispatch("chat/getPublicChats")},q=async l=>{l!==g.value&&(n("close"),await p(l),L(l),se.push({query:{chatId:l}}))},L=l=>{if(!a.value.length)return;const R=a.value.findIndex(G=>G===l);R!==-1&&a.value.splice(R,1)};return Z(async()=>{await k(),await M(),e.on(T.NEW_MESSAGE,l=>{l.chat!==g.value&&($(l.chat)||a.value.push(l.chat))})}),{chatsList:d,selectChat:q,selectedChatId:g,chatIdsPool:a,isProgressStatusSelectedChat:i,currentUser:h}},components:{ChatItem:Us}},xs={key:0,class:"overflow-y-auto truncate"},Es={key:1,class:"p-2"};function ks(t,n,s,e,d,h){const a=c("chat-item");return e.chatsList&&e.currentUser?(o(),_("div",xs,[(o(!0),_(x,null,z(e.chatsList,i=>(o(),S(a,{key:e.chatsList._id,chat:i,"is-selected":e.selectedChatId===i._id,onSelectChat:e.selectChat,"chat-ids-pool":e.chatIdsPool,"current-user":e.currentUser},null,8,["chat","is-selected","onSelectChat","chat-ids-pool","current-user"]))),128))])):(o(),_("span",Es,u(t.$t("No public chats")),1))}var Ts=C(Ms,[["render",ks]]);const $s={name:"Home",setup(){be();const t=J("socket"),n=Ce(),s=v(()=>n.getters["user/user"]),e=w(""),d=w(!0),h=()=>{var a;((a=s.value)==null?void 0:a.chats)&&s.value.chats.length&&t.emit(O.SET_USER_ONLINE,s.value),d.value=!1};return Y(s,a=>{a&&d.value&&h()}),Q(V({},ms()),{searchQuery:e,user:s})},components:{CurrentChat:Qt,TheSidebar:es,TheSidebarMobile:cs,TheSidebarSettings:_s,ChatsList:Ts,UserInfo:ae}},Ns={class:"h-screen min-w-full min-h-full overflow-hidden"};function Os(t,n,s,e,d,h){const a=c("app-hamburger"),i=c("app-search"),g=c("chats-list"),p=c("the-sidebar"),M=c("the-sidebar-mobile"),$=c("user-info"),k=c("the-sidebar-settings"),q=c("current-chat");return o(),_("div",Ns,[m(p,{"is-active":t.isSidebarOpen},{header:I(()=>[m(a,{onClick:t.openSidebarSettings},null,8,["onClick"]),m(i,{modelValue:e.searchQuery,"onUpdate:modelValue":n[0]||(n[0]=L=>e.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[m(g,{"search-query":e.searchQuery},null,8,["search-query"])]),_:1},8,["is-active"]),m(M,{"is-active":t.isMobileSidebarOpen,onClose:t.closeMobileSidebar},{header:I(()=>[m(a,{onClick:t.openSidebarSettings},null,8,["onClick"]),m(i,{modelValue:e.searchQuery,"onUpdate:modelValue":n[1]||(n[1]=L=>e.searchQuery=L)},null,8,["modelValue"])]),body:I(()=>[m(g,{onClose:t.closeMobileSidebar,"search-query":e.searchQuery},null,8,["onClose","search-query"])]),_:1},8,["is-active","onClose"]),m(k,{"is-active":t.isSidebarSettingsOpen,onClose:t.closeSidebarSettings},{header:I(()=>[e.user?(o(),S($,{key:0,user:e.user,onClose:t.closeSidebarSettings},null,8,["user","onClose"])):b("",!0)]),body:I(()=>[]),_:1},8,["is-active","onClose"]),r("div",{class:D([t.isSidebarOpen?"ml-64":"ml-0"])},[e.user?(o(),S(q,{key:0,"current-user":e.user,onToggleSidebar:t.toggleSidebar,"is-sidebar-open":t.isSidebarOpen},null,8,["current-user","onToggleSidebar","is-sidebar-open"])):b("",!0)],2)])}var js=C($s,[["render",Os]]);export{js as default};
